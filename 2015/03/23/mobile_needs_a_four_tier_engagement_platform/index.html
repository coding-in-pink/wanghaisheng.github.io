
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>&lt;微服务架构在Netflix的应用&gt;系列博文-1 移动应用所需要的四层架构 | 海生的世界</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Edwin">
    

    
    <meta name="description" content="版权声明：欢迎转载本站的所有内容，本站的所有文章使用知识共享署名-非商业性使用-相同方式共享 3.0 Unported许可协议，唯一的要求就是保留署名权，请在转载时注明出处。

第一篇-移动应用所需要的四层架构&amp;lt;微服务架构在Netflix的应用&amp;gt;系列博文-共四篇
英文版： 第一部分： The Four-Tier Engagement Platform中文版：第一部分：移动应用所需要的四">
<meta property="og:type" content="article">
<meta property="og:title" content="<微服务架构在Netflix的应用>系列博文-1 移动应用所需要的四层架构">
<meta property="og:url" content="http://wanghaisheng.github.io/2015/03/23/mobile_needs_a_four_tier_engagement_platform/index.html">
<meta property="og:site_name" content="海生的世界">
<meta property="og:description" content="版权声明：欢迎转载本站的所有内容，本站的所有文章使用知识共享署名-非商业性使用-相同方式共享 3.0 Unported许可协议，唯一的要求就是保留署名权，请在转载时注明出处。

第一篇-移动应用所需要的四层架构&amp;lt;微服务架构在Netflix的应用&amp;gt;系列博文-共四篇
英文版： 第一部分： The Four-Tier Engagement Platform中文版：第一部分：移动应用所需要的四">
<meta property="og:image" content="http://blogs.forrester.com/f/b/users/TSCHADLER/engagement_platform_2.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="<微服务架构在Netflix的应用>系列博文-1 移动应用所需要的四层架构">
<meta name="twitter:description" content="版权声明：欢迎转载本站的所有内容，本站的所有文章使用知识共享署名-非商业性使用-相同方式共享 3.0 Unported许可协议，唯一的要求就是保留署名权，请在转载时注明出处。

第一篇-移动应用所需要的四层架构&amp;lt;微服务架构在Netflix的应用&amp;gt;系列博文-共四篇
英文版： 第一部分： The Four-Tier Engagement Platform中文版：第一部分：移动应用所需要的四">
<meta name="twitter:creator" content="@edwin_uestc">
<link rel="publisher" href="111190881341800840000">

    
    <link rel="alternative" href="/atom.xml" title="海生的世界" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="海生的世界" title="海生的世界"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="海生的世界">海生的世界</a></h1>
				<h2 class="blog-motto">正在打怪升级中～～～</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:wanghaisheng.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/03/23/mobile_needs_a_four_tier_engagement_platform/" title="&lt;微服务架构在Netflix的应用&gt;系列博文-1 移动应用所需要的四层架构" itemprop="url">&lt;微服务架构在Netflix的应用&gt;系列博文-1 移动应用所需要的四层架构</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/111190881341800840000?rel=author" title="Edwin" target="_blank" itemprop="author">Edwin</a>
		
  <p class="article-time">
    <time datetime="2015-03-23T03:17:12.000Z" itemprop="datePublished"> 发表于 Mar 23 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#第一篇-移动应用所需要的四层架构"><span class="toc-number">1.</span> <span class="toc-text">第一篇-移动应用所需要的四层架构</span></a></li></ol>
		
		</div>
		
		<blockquote>
<p>版权声明：<br>欢迎转载本站的所有内容，本站的所有文章使用<a href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh" target="_blank" rel="external">知识共享署名-非商业性使用-相同方式共享 3.0 Unported许可协议</a>，唯一的要求就是保留署名权，请在转载时注明出处。</p>
</blockquote>
<h2 id="第一篇-移动应用所需要的四层架构">第一篇-移动应用所需要的四层架构</h2><p>&lt;微服务架构在Netflix的应用&gt;系列博文-共四篇</p>
<p>英文版： <a href="(http://blogs.forrester.com/ted_schadler/13-11-20-mobile_needs_a_four_tier_engagement_platform/">第一部分： The Four-Tier Engagement Platform</a><br>中文版：<br><a href="http://wanghaisheng.github.io/2015/03/23/time-to-move-to-a-four-tier-application-architecture" target="_blank" rel="external">第一部分：移动应用所需要的四层架构/</a></p>
<p>英文版： <a href="http://nginx.com/blog/time-to-move-to-a-four-tier-application-architecture/" target="_blank" rel="external">第二部分：http://nginx.com/blog/time-to-move-to-a-four-tier-application-architecture/</a><br>中文版：<br><a href="http://wanghaisheng.github.io/2015/03/23/time-to-move-to-a-four-tier-application-architecture" target="_blank" rel="external">第二部分：是时候转移到四层架构上来了/</a></p>
<p>英文版： <a href="http://nginx.com/blog/microservices-at-netflix-architectural-best-practices/" target="_blank" rel="external">第三部分：微服务架构在Netflix的应用：架构设计的经验教训</a><br>中文版：<br><a href="http://wanghaisheng.github.io/2015/03/23/microservices-at-netflix-architectural-best-practices" target="_blank" rel="external">第三部分：微服务架构在Netflix的应用：架构设计的经验教训</a></p>
<p>英文版：<br><a href="http://nginx.com/blog/adopting-microservices-at-netflix-lessons-for-team-and-process-design/" target="_blank" rel="external">第四部分：Adopting Microservices at Netflix: Lessons for Team and Process Design </a><br>中文版：<br><a href="http://wanghaisheng.github.io/2015/03/23/adopting-microservices-at-netflix-lessons-for-team-and-process-design" target="_blank" rel="external">第四部分：微服务架构在Netflix的应用：团队和流程设计相关的经验教训</a></p>
<p>Michael Facemire, John McCarthy和作者最近向整个软件技术行业发起了倡议：老式的web不是为移动APP和网站而设计的，也不能处理互联式产品的实时需求。是时候提出一种新架构了。</p>
<p>大致总结如下:</p>
<p>移动互联网把传统的web架构推到了悬崖的边缘。为传统PC的浏览器而设计的三层架构不够灵活，不能很好地扩展，也不能提供良好的移动端的用户体验，满足互联式产品的新兴需求。移动互联网的volatility and velocity of change需要的是一种分布式的四层架构，我们称之为“engagement platform”。<br>这个平台能够将技术功能分成4部分：客户端、分发端、集成聚合端、和服务端。</p>
<p>移动互联网APP的新需求需要将CDN、应用服务器供应商、移动端中间件供应商、PAAS供应商、各种初创公司和其他公司围绕着这四层架构整合起来。<br>CIO需要立即规划从三层架构到四层架构的迁移工作。</p>
<p>是时候扔掉三层架构，即表现层、应用层和数据层，转向能够满足新需求的四层架构模型：</p>
<blockquote>
<p>“engagement platform”支持分布式的四层架构，能够提供优质的用户体验、优异的性能，以及与任何设备之间的模块化集成。</p>
</blockquote>
<p>Figure 1 The Four-Tier Engagement Platform Makes Delivery Its Own Tier<br><img src="http://blogs.forrester.com/f/b/users/TSCHADLER/engagement_platform_2.png" alt=""></p>
<p>四层架构的处理流程如下:</p>
<ul>
<li>客户端层负责不同设备的唯一性的确定。 这一展现层将每个app以及设备(桌面端、移动端，浏览器或原生APP)的特殊功能与后台应用程序的服务隔离起来。这个边界使得开发人员可以将后台服务的开发与消费它们的app独立开来，比如航班状态和入港通知等等。确定明确的边界提高了开发人员的效率，无需顾及繁重的维护工作，一个良好的网络环境也是很重要的。</li>
<li>分发层处理中间的和最后一英里的问题。通过客户端层的信息决定交付特定场景下具体内容的最佳方式。通过over-the-wire的内容转换—这里与聚合层不同，聚合层使用的基于协议的转换，利用 edge-of-network cache 功能来增加动态数据， 如Akamar等提供的CDN、如Instart Logic的分发优化方案、如Riverbed Stingray的应用分发控制和on-premises in-memory database caches一起完成这方面的任务</li>
<li>聚合层负责内部和外部服务的集成和数据的转换。这样的API层有两方面的角色，不同APP请求和服务<br>的发现和客户端请求与后台服务的双向转换。这样能够使得底层数据的组装和服务更加简洁，能够提供相对实时的数据格式的转换。服务组合外加上商务智能、分析、基于角色的访问等更加动态。</li>
<li>服务层包括了内部外部提供数据和功能。通过一系列连贯的可部署的服务来动态组装服务和业务流程。<br>该层负责为上述三层提供数据，不关心数据具体如何使用。其他几层可以部署在防火墙内也可以部署在防火墙外，或者二种方式相结合。这样不论是APP使用还是生态系统中其他系统使用，在服务的动态组合和访问上就提供了相当的灵活性</li>
</ul>
<p>未来的展望</p>
<p>问: 如果未来是engagement platform的天下，如何实现呢？</p>
<p>答: 颠覆现在的软件行业的核心架构。IBM, Microsoft, Oracle, and Akamai一直在推三层架构，现在将被<br>Netflix, Kinvey, and Salesforce.com提出的四层架构所替代。</p>
<p>是时候供应商、投资人员、架构师和开发人员对如何来构建和使用engagement platform展开讨论了。</p>
<p>engagement platform”支持分布式的四层架构，能够提供优质的用户体验、优异的性能，以及与任何设备之间的模块化集成，并且能够推动这些颠覆的演化:</p>
<ul>
<li>公司将依赖于供应商的生态系统来deliver engagement. 你无须购买这个engagement platform平台。而且这个engagement platform平台也不是全部受你直接控制。相反，你以松耦合的方式组装各种<br>engagement 功能，而且能够按需扩展，同时能够保持灵活性，也能够解决持续交付的问题。</li>
<li>HTTP traffic on Nginx will surpass the traffic on Apache. If you don’t know what those things are, don’t worry about it. If you don’t but think you should, then see the last chart here and learn about it here and here.</li>
<li>IBM, Oracle, Microsoft, SAP, and Salesforce.com will rethink their middleware products and architectures. Adding mobile app lipstick on an application server won’t solve the delivery challenge by itself. These companies will slowly overcome their reluctance and begin to operate in a four-tier, ecosystem-dependent platform. But it will take five years for that to happen. Microsoft Azure is the farthest along, but still tentative in its strategy and execution.</li>
<li>The content delivery network industry will accumulate content and performance optimization services. Akamai, Limelight, and Amazon CloudFront have done good work for the Web. But new approaches from Instart Logic and rumblings from Akamai point to the delivery-tier future.</li>
<li>Platform-as-a-service providers like Amazon, Google, IBM, Microsoft, and Salesforce will grow many new platform services. For example, services in the aggregation tier loosely coupled with an intelligent delivery tier will handle notification at scale, including personalized messages, open-message analytics, and device and network customization.</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/日记/">日记</a>►<a class="article-category-link" href="/categories/日记/架构/">架构</a>►<a class="article-category-link" href="/categories/日记/架构/微服务/">微服务</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/微服务/">微服务</a><a href="/tags/日记/">日记</a><a href="/tags/架构/">架构</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://wanghaisheng.github.io/2015/03/23/mobile_needs_a_four_tier_engagement_platform/" data-title="&lt;微服务架构在Netflix的应用&gt;系列博文-1 移动应用所需要的四层架构 | 海生的世界" data-tsina="1998662112" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/03/23/time-to-move-to-a-four-tier-application-architecture/" title="&lt;微服务架构在Netflix的应用&gt;系列博文-2 是时候转移到四层架构上来了">
  <strong>上一篇：</strong><br/>
  <span>
  &lt;微服务架构在Netflix的应用&gt;系列博文-2 是时候转移到四层架构上来了</span>
</a>
</div>


<div class="next">
<a href="/2015/02/09/web-api-from-start-finish-2/"  title="读&lt; 从业务角度看API &gt;">
 <strong>下一篇：</strong><br/> 
 <span>读&lt; 从业务角度看API &gt;
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#第一篇-移动应用所需要的四层架构"><span class="toc-number">1.</span> <span class="toc-text">第一篇-移动应用所需要的四层架构</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/日记/HTTP-API/" title="HTTP API">HTTP API<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/数据仓库/KAFKA/" title="KAFKA">KAFKA<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/数据仓库/KAFKA/PostgreSQL/" title="PostgreSQL">PostgreSQL<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/HTTP-API/REST/" title="REST">REST<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/REST/" title="REST">REST<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/rhadoop/docker/" title="docker">docker<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/rhadoop/" title="rhadoop">rhadoop<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/互联网医疗/" title="互联网医疗">互联网医疗<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/架构/微服务/" title="微服务">微服务<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/数据仓库/" title="数据仓库">数据仓库<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/日志/" title="日志">日志<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/" title="日记">日记<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/日记/架构/" title="架构">架构<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/生活日志/" title="生活日志">生活日志<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/碎碎念/碎碎念/" title="碎碎念">碎碎念<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/碎碎念/" title="碎碎念">碎碎念<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/日志/第一天/" title="第一天">第一天<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/日记/" title="日记">日记<sup>15</sup></a></li>
			
		
			
				<li><a href="/tags/架构/" title="架构">架构<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/微服务/" title="微服务">微服务<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/REST/" title="REST">REST<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/碎碎念/" title="碎碎念">碎碎念<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/HTTP-API/" title="HTTP API">HTTP API<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/数据仓库/" title="数据仓库">数据仓库<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/KAFKA/" title="KAFKA">KAFKA<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/碎碎念/" title="碎碎念">碎碎念<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/PostgreSQL/" title="PostgreSQL">PostgreSQL<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/rhadoop/" title="rhadoop">rhadoop<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/模板/" title="模板">模板<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/互联网医疗/" title="互联网医疗">互联网医疗<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/PGHD/" title="PGHD">PGHD<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Github-pages/" title="Github pages">Github pages<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/博客/" title="博客">博客<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Oracle/" title="Oracle">Oracle<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Ubuntu/" title="Ubuntu">Ubuntu<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://www.sciencenet.cn/" target="_blank" title="科学网">科学网</a></li>
      <li><a href="http://motorcycleguy.blogspot.com" target="_blank" title="zippera">Keith Boone's Blog</a></li>
      <li><a href="http://www.healthintersections.com.au/" target="_blank" title="Grahame Grieve">Grahame Grieve's Blog</a></li>
      <li><a href="http://mooc.guokr.com/" target="_blank" title="MOOC学院">MOOC学院</a></li>
      <li><a href="https://trello.com/" target="_blank" title="Trello">Trello工具</a></li>


        
          <li>
            
            	<a href="https://coderq.com" target="_blank" title="一个面向程序员交流分享的新一代社区">码农圈</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me" target="_blank" title="Jark&#39;s Blog">Jark&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>


  

<div class="doubanshow">
<p class="asidetitle">豆瓣秀</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/48701103/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello,I&#39;m wanghaisheng. For now I&#39;m a engineer in ShangHai. <br/>
			曾几何时，幻想着自己能文思如尿奔，写一些生活的感悟，记录一些成长的足迹，辗转从qq空间到chinaunix再到科学网，种种不适，最终在这里落脚。 这里是海生(edwin)的小窝，记录着海生成长过程中的酸甜苦辣。虽努力地想让大家看到、了解、认识真实的自己，海生却不如自己所想的那般勇敢和自信，这其中或多或少是由于天生的那点自尊、自恋和自卑在作祟。文字总是唯美的，我可爱的朋友们，希望你们能够从这些拙劣的话语中找到一丝丝温暖，感受到一丝丝温馨.如果看了我的碎碎念之后,你有要说话的冲动，请不要过分珍惜你的键盘或者是我的空间 －－ 因为，你是我的朋友。</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/edwinuestc" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/wanghaisheng" target="_blank" class="icon-github" title="github"></a>
		
		
		
		<a href="https://twitter.com/edwin_uestc" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		
		
		<a href="https://www.douban.com/people/48701103" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		
		<a href="https://plus.google.com/111190881341800840000?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:edwin_uestc@163.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="Edwin">Edwin</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
